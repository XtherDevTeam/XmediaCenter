<script>

var chapters = [];
var files = [];

function init() {
    {% for i in book['chapters'] %}
    chapters.push(["{{i[0]|safe}}","{{i[1]|safe}}"])
    {% endfor %}
    {% for i in book['files'] %}
    files.push("{{i|safe}}");
    {% endfor %}
}

function goto_current_index(str){
    window.location = '/reader?path="{{path}}"&index=' + String(files.indexOf(str))
}

function back_to_indexing(){
    window.location = '/reader?path="{{path}}"';
}

function go_next(idx) {
    idx++;
    if(idx == -1 || idx >= {{ total_index }}){
        idx--;
    }
    goto_current_index(files[idx]);
}

function go_back(idx) {
    idx--;
    if(idx == -1 || idx >= {{ total_index }}){
        idx++;
    }
    goto_current_index(files[idx]);
}

function create_iframe_object(idx) {
    path = "/api?action=epub_api&request=get_iframe_object&epub=%22{{ path }}%22&file=" + files[idx];
    $('#iframe').attr("src",path)
}
</script>

<div class="xmc-container" style="height: 85%;">
    <br>
    <div style="width: 90%;height: 100%;margin: 0 auto;">
        <h3>{{ book['title'] }}</h3>
        <h5>{{ book['author'] }}</h5>
        <h5>Index: {{ now_index }}/{{ total_index }}</h5>
        <iframe id="iframe" src="" style="width: 100%;height: 70%;margin: 0 auto;"></iframe><br>
        <a class="btn btn-primary" href="javascript:void(0);" onclick="back_to_indexing();">Index</a>
        <a class="btn btn-primary" href="javascript:void(0);" onclick="go_back({{now_index}});">Back</a>
        <a class="btn btn-primary" href="javascript:void(0);" onclick="go_next({{now_index}});">Next</a>
        <br>
    </div>
    <br>
</div>
<script>
    init()
    create_iframe_object({{ now_index }});
</script>